version: 1
applications:
  - appRoot: apps/admin
    frontend:
      phases:
        preBuild:
          commands:
            - npm install -g pnpm
            - pnpm install
        build:
          commands:
            - echo "HOST=$HOST" >> ./apps/admin/.env
            - echo "AUTH_URL=$AUTH_URL" >> ./apps/admin/.env
            - echo "AUTH_SECRET=$AUTH_SECRET" >> ./apps/admin/.env
            - echo "DATABASE_URL=$DATABASE_URL" >> ./apps/admin/.env
            - echo "AUTH_GOOGLE_ID=$AUTH_GOOGLE_ID" >> ./apps/admin/.env
            - echo "AUTH_GOOGLE_SECRET=$AUTH_GOOGLE_SECRET" >> ./apps/admin/.env
            - echo "AUTH_KAKAO_ID=$AUTH_KAKAO_ID" >> ./apps/admin/.env
            - echo "AUTH_KAKAO_SECRET=$AUTH_KAKAO_SECRET" >> ./apps/admin/.env
            - echo "ACCESS_KEY_ID=$ACCESS_KEY_ID" >> ./apps/admin/.env
            - echo "SECRET_ACCESS_KEY=$SECRET_ACCESS_KEY" >> ./apps/admin/.env
            - echo "NEXT_PUBLIC_AWS_REGION=$NEXT_PUBLIC_AWS_REGION" >> ./apps/admin/.env
            - echo "NEXT_PUBLIC_AWS_S3_ACCESS_KEY_ID=$NEXT_PUBLIC_AWS_S3_ACCESS_KEY_ID" >> ./apps/admin/.env
            - echo "NEXT_PUBLIC_AWS_S3_SECRET_ACCESS_KEY=$NEXT_PUBLIC_AWS_S3_SECRET_ACCESS_KEY" >> ./apps/admin/.env
            - echo "NEXT_PUBLIC_AWS_S3_BUCKET_NAME=$NEXT_PUBLIC_AWS_S3_BUCKET_NAME" >> ./apps/admin/.env
            - echo "NEXT_PUBLIC_AWS_S3_BUCKET_URL=$NEXT_PUBLIC_AWS_S3_BUCKET_URL" >> ./apps/admin/.env
            - pnpm run build
      artifacts:
        baseDirectory: apps/admin/.next
        files:
          - "**/*"
      cache:
        paths:
          - .next/cache/**/*
          - node_modules/**/*
      buildPath: /
